# vim: filetype=tqfolder
# -*- mode: tqfolder -*-
# to get proper syntax highlighting and indentation when using emacs,
# add the following line to your .emacs file:
#   (load-file "$TQPATH/share/tqfolder.el")

+CutBase2Leptons {
    <.cutExpression = "$(NLeptons) == 2", .title="Base cut (2 leptons)">
+CutBaseChannelSplit {
    <.cutExpression = "$(fitsChannel)", .weightExpression = "[MCWeight] * [PUWeight] * $(PRWFix) * [LeptonSF] * [JvtSF] * [TTbarNNLOWeight]", .title="Base cut (channel split)">

    +CutApplyTTBarSplitting {
        <.cutExpression = "$(applyTTBarSplitting) ? ($(isDiLepTTbar) == $(MCTCisLeptonicTopDecay)) : 1", .title="Split ttbar">

    +CutApplyPromptBkgSplitting {
        <.cutExpression = "$(applyPromptBkgSplitting) ? ($(isPromptBkg) == ($(Lepton0FakeType) == 0 && $(Lepton1FakeType) == 0)) : 1", .title="Split prompt/non-prompt backgrounds">

    +CutApplyZjetsSplitting {
        <.cutExpression = "$(applyZjetsSplitting) ? ($(isZjetsHF) == ($(BJet0isHF) && $(BJet1isHF))) : 1", .title="Split Zjets">

    +CutTriggerMatching {
        <.cutExpression = "$(Trigger) != 0", .weightExpression="[TriggerSF]", .title="Trigger selection and matching">

    +CutOS {
        <.cutExpression = "$(Lepton0Charge) * $(Lepton1Charge) == ($(isddFake) ? 1 : -1)", .weightExpression="[ddFakeWeight]", .title="Oppsite charge">

        ##################
        #   2TagRegion   #
        ##################

        +Cut2Tag_DL1r_FixedCutBEff70 {
            <.cutExpression = "$(NBJets_DL1r_70)==2", .title="NBJets=2 (DL1r, FixedCutBEff_70)", .weightExpression="[BTagSF:DL1r:FixedCutBEff_70]">
                +Cut2TagMllSR1_DL1r_FixedCutBEff70 {
                    <.cutExpression = "15*1000 < $(DiLeptonMass) && $(DiLeptonMass) < ($(isSF) ? 75*1000 : 110*1000) && $(VBFVeto)", .title="SR1: 15 GeV < m_{\ell\ell} < 75 (110) GeV + VBFVeto">
                }
                +Cut2TagMbbSR2_DL1r_FixedCutBEff70 {
                    <.cutExpression = "$(isSF) && 75*1000 < $(DiLeptonMass) && $(DiLeptonMass) < 110*1000 && 40*1000 < $(DiBJetMass) && $(DiBJetMass) < 210*1000", .title="SR2: 75 GeV < m_{\ell\ell} < 110 GeV, 40 GeV < m_{bb} < 210 GeV, SF only">
                }
                +Cut2TagMllTopCR_DL1r_FixedCutBEff70 {
                    <.cutExpression = "110*1000 < $(DiLeptonMass)", .title="TopCR: 110 GeV < m_{\ell\ell}">
                }
        }
        +Cut2Tag_DL1r_FixedCutBEff77 {
            <.cutExpression = "$(NBJets_DL1r_77)==2", .title="NBJets=2 (DL1r, FixedCutBEff_77)", .weightExpression="[BTagSF:DL1r:FixedCutBEff_77]">
                +Cut2TagMllSR1_DL1r_FixedCutBEff77 {
                    <.cutExpression = "15*1000 < $(DiLeptonMass) && $(DiLeptonMass) < ($(isSF) ? 75*1000 : 110*1000) && $(VBFVeto)", .title="SR1: 15 GeV < m_{\ell\ell} < 75 (110) GeV + VBFVeto">
                }
                +Cut2TagMbbSR2_DL1r_FixedCutBEff77 {
                    <.cutExpression = "$(isSF) && 75*1000 < $(DiLeptonMass) && $(DiLeptonMass) < 110*1000 && 40*1000 < $(DiBJetMass) && $(DiBJetMass) < 210*1000", .title="SR2: 75 GeV < m_{\ell\ell} < 110 GeV, 40 GeV < m_{bb} < 210 GeV, SF only">
                }
                +Cut2TagMllTopCR_DL1r_FixedCutBEff77 {
                    <.cutExpression = "110*1000 < $(DiLeptonMass)", .title="TopCR: 110 GeV < m_{\ell\ell}">
                }
        }
        +Cut2Tag_DL1r_FixedCutBEff85 {
            <.cutExpression = "$(NBJets_DL1r_85)==2", .title="NBJets=2 (DL1r, FixedCutBEff_85)", .weightExpression="[BTagSF:DL1r:FixedCutBEff_85]">
                +Cut2TagMllSR1_DL1r_FixedCutBEff85 {
                    <.cutExpression = "15*1000 < $(DiLeptonMass) && $(DiLeptonMass) < ($(isSF) ? 75*1000 : 110*1000) && $(VBFVeto)", .title="SR1: 15 GeV < m_{\ell\ell} < 75 (110) GeV + VBFVeto">
                }
                +Cut2TagMbbSR2_DL1r_FixedCutBEff85 {
                    <.cutExpression = "$(isSF) && 75*1000 < $(DiLeptonMass) && $(DiLeptonMass) < 110*1000 && 40*1000 < $(DiBJetMass) && $(DiBJetMass) < 210*1000", .title="SR2: 75 GeV < m_{\ell\ell} < 110 GeV, 40 GeV < m_{bb} < 210 GeV, SF only">
                }
                +Cut2TagMllTopCR_DL1r_FixedCutBEff85 {
                    <.cutExpression = "110*1000 < $(DiLeptonMass)", .title="TopCR: 110 GeV < m_{\ell\ell}">
                }
        }

        ##################
        #   1TagRegion   #
        ##################

        +Cut1Tag_DL1r_FixedCutBEff70 {
            <.cutExpression = "$(NBJets_DL1r_70)==1", .title="NBJets=1 (DL1r, FixedCutBEff_70)", .weightExpression="[BTagSF:DL1r:FixedCutBEff_70]">
                +Cut1TagMllSR1_DL1r_FixedCutBEff70 {
                    <.cutExpression = "15*1000 < $(DiLeptonMass) && $(DiLeptonMass) < ($(isSF) ? 75*1000 : 110*1000)", .title="SR1: 15 GeV < m_{\ell\ell} < 75 (110) GeV">
                }
                +Cut1TagMllSR2_DL1r_FixedCutBEff70 {
                    <.cutExpression = "$(isSF) && 75*1000 < $(DiLeptonMass) && $(DiLeptonMass) < 110*1000", .title="SR2: 75 GeV < m_{\ell\ell} < 110 GeV, SF only">
                }
                +Cut1TagMllTopCR_DL1r_FixedCutBEff70 {
                    <.cutExpression = "110*1000 < $(DiLeptonMass)", .title="TopCR: 110 GeV < m_{\ell\ell}">
                }
        }
        +Cut1Tag_DL1r_FixedCutBEff77 {
            <.cutExpression = "$(NBJets_DL1r_77)==1", .title="NBJets=1 (DL1r, FixedCutBEff_77)", .weightExpression="[BTagSF:DL1r:FixedCutBEff_77]">
            +Cut1TagOS_DL1r_FixedCutBEff77 {
                <.cutExpression = "$(Lepton0Charge) * $(Lepton1Charge) == -1", .title="Oppsite charge">
                +Cut1TagMllSR1_DL1r_FixedCutBEff77 {
                    <.cutExpression = "15*1000 < $(DiLeptonMass) && $(DiLeptonMass) < ($(isSF) ? 75*1000 : 110*1000)", .title="SR1: 15 GeV < m_{\ell\ell} < 75 (110) GeV">
                }
                +Cut1TagMllSR2_DL1r_FixedCutBEff77 {
                    <.cutExpression = "$(isSF) && 75*1000 < $(DiLeptonMass) && $(DiLeptonMass) < 110*1000", .title="SR2: 75 GeV < m_{\ell\ell} < 110 GeV, SF only">
                }
                +Cut1TagMllTopCR_DL1r_FixedCutBEff77 {
                    <.cutExpression = "110*1000 < $(DiLeptonMass)", .title="TopCR: 110 GeV < m_{\ell\ell}">
                }
            }
        }
        +Cut1Tag_DL1r_FixedCutBEff85 {
            <.cutExpression = "$(NBJets_DL1r_85)==1", .title="NBJets=1 (DL1r, FixedCutBEff_85)", .weightExpression="[BTagSF:DL1r:FixedCutBEff_85]">
                +Cut1TagMllSR1_DL1r_FixedCutBEff85 {
                    <.cutExpression = "15*1000 < $(DiLeptonMass) && $(DiLeptonMass) < ($(isSF) ? 75*1000 : 110*1000)", .title="SR1: 15 GeV < m_{\ell\ell} < 75 (110) GeV">
                }
                +Cut1TagMllSR2_DL1r_FixedCutBEff85 {
                    <.cutExpression = "$(isSF) && 75*1000 < $(DiLeptonMass) && $(DiLeptonMass) < 110*1000", .title="SR2: 75 GeV < m_{\ell\ell} < 110 GeV, SF only">
                }
                +Cut1TagMllTopCR_DL1r_FixedCutBEff85 {
                    <.cutExpression = "110*1000 < $(DiLeptonMass)", .title="TopCR: 110 GeV < m_{\ell\ell}">
                }
        }

    } # CutOS
    } # CutTriggerMatching
    } # CutApplyZjetsSplitting
    } # CutApplyPromptBkgSplitting
    } # CutApplyTTBarSplitting
} # CutBaseChannelSplit
} # CutBase2Leptons
